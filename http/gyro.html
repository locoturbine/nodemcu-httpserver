<!doctype html>
<html>
<head>
    <meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no,initial-scale=1, maximum-scale=1">
    <title>Force demo</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/roomba.js"></script>

    <!--<script src="js/main.js"></script>-->



</head>


<body onload="init()"; changeDirection(20,20);>
<script>

    function init()
    {
        if (window.DeviceOrientationEvent) {

            var lastBeta = 0;
            var lastGamma = 0 ;

            window.addEventListener("deviceorientation", function(event)
            {
                document.getElementById("x").style.webkitTransform = "scaleX("+(Math.round(event.beta))+")";
                document.getElementById("y").style.webkitTransform = "scaleY("+(Math.round(event.gamma))+")";
                document.getElementById("angle").style.webkitTransform = "rotateZ("+(Math.round(event.alpha))+"deg)";
                //	document.getElementById("gamma").innerHTML = Math.round(event.gamma);
                //	document.getElementById("beta").innerHTML = Math.round(event.beta);

                var betaDiff = Math.abs(Math.round(event.beta) - lastBeta )
                if (betaDiff >= 5 ) {
                    lastBeta = Math.round(event.beta)
                    document.getElementById("beta").innerHTML = Math.round(event.beta) + " : " + betaDiff;
                    changeDirection(lastBeta,lastGamma);
                }
                var gammaDiff = Math.abs(Math.round(event.gamma) - lastGamma )
                if (gammaDiff >= 5 ) {
                    lastGamma = Math.round(event.gamma)
                    document.getElementById("gamma").innerHTML = Math.round(event.gamma) + " : " + gammaDiff;
                    changeDirection(lastBeta,lastGamma);
                }

            }, true);



        } else {
            alert("Sorry, your browser doesn't support Device Orientation");
        }
    }

    function changeDirection(beta, gamma ) {
	var speed = 0 ;
        var angle = 0 ;
        if (gamma > 0){
            angle = beta;
            speed = Math.round((1 - gamma/90) * 500);
        }
        else if (gamma < 0 ) {
            speed =  Math.round(((-1) * gamma/90 - 1) * 500);
            angle = beta ;
        }
        document.getElementById("drive").innerHTML = "speed: " + speed +  " angle: " + angle;
	roomba.drive(speed,angle);

    }

</script>
<div id="label" class="start"></div>

   <div id="x" class="line"></div>
   <div id="y" class ="line"></div>
   <div id="angle"></div>
	<div id="guideX"></div>
	<div id="guideY"></div>
    <div><label>Gamma: <label id="gamma"></label>
        <label>Beta: <label id="beta"></label>
    </div>
   <div><label>Drive: <label id="drive"></label></div>
</body>
</html>
